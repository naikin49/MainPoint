# Telegram Voice Analysis Bot

## Описание
Приложение, которое принимает голосовые сообщения через Telegram, преобразует их в текст, анализирует главную мысль и эмоции, а затем сохраняет результаты в базе данных MS SQL Server. 

---

## Структура файлов

- **`main.py`**  
  Основной файл для запуска приложения.

- **`TG.py`**  
  Основная логика Telegram-бота. Обрабатывает входящие голосовые сообщения, преобразует их в текст, вызывает анализ текста и взаимодействует с базой данных.

- **`Audio_processing.py`**  
  Содержит функции для обработки аудиофайлов и преобразования их в текст с помощью Google Speech Recognition.

- **`text_analysis.py`**  
  Содержит функции для анализа текста с использованием модели BERT для определения эмоциональной окраски текста.

- **`nlp_ask.py`**  
  Отвечает за отправку текста в API Ollama для выделения главной мысли из текста.

- **`DB.py`**  
  Обеспечивает взаимодействие с базой данных MS SQL Server, включая добавление записей через хранимую процедуру.

- **`config.env.example`**  
  Пример конфигурационного файла с необходимыми переменными окружения (без чувствительных данных).

- **`start.py`**  
  Скрипт для автоматического запуска Ollama и основного приложения.

---

## Требования

- Python 3.8+
- Microsoft SQL Server 2022 (настроенный на аутентификацию через логин и пароль, поддержка TCP/IP)
- Установленные зависимости (см. ниже)
- Запущенный Ollama API (на локальном хосте по порту 11434)

---

## Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/naikin49/MainPoint.git
   cd your-repository/src

2. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt

3. **Настройте переменные окружения:**
    Скопируйте пример файла конфигурации:
   ```bash
   cp config.env.example config.env
   ```
   Заполните config.env необходимыми значениями:
   ```bash
    Telegram_Token=Ваш_токен_бота
    Server_name=имя_сервера
    DB_Name=имя_базы_данных
    DB_user_name=имя_пользователя
    DB_user_password=пароль_пользователя
   ```

4. **Настройте MS SQL Server:**
   Убедитесь, что порт 1433 доступен.
   Добавьте хранимые процедуры и таблицы в базу данных (см. папку db).

---

## Запуск

1. **Запустите Ollama API (убедитесь, что он настроен и работает):**
   ```bash
   Ollama llama3.1:8B
   ```

2. **Запустите Telegram-бота:**
   ```bash
   python main.py
   ```

**Или просто запустите скрипт для автоматического запуска Ollama и основного приложения.**
   ```bash
   python start.py
   ```

---

## Основной функционал

1. **Обработка голосовых сообщений:**
   Голосовые сообщения конвертируются в текст, анализируются, а результаты сохраняются в базу данных.

2. **Выделение главной мысли:**
   Используется API Ollama для выделения основной идеи из текста.

3. **Анализ эмоций:**
   Анализ текста с помощью BERT для определения тональности (позитивной, негативной или нейтральной).

4. **Взаимодействие с базой данных:**
   Сохранение результатов анализа, включая аудиофайлы, текст и метаданные.

---

## Пример взаимодействия

1. **Пользователь отправляет голосовое сообщение боту.**
2. **Бот конвертирует аудио в текст:**
    "Я очень доволен вашей работой!"
3. **Анализ эмоций определяет:**
    Тональность: Позитивная
    Главная мысль: "Пользователь доволен работой"
4. **Результат сохраняется в базе данных и отправляется пользователю.**

---

## Контакты

Для вопросов и предложений пишите на email: naikinfufaikin@gmail.com
